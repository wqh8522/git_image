# Java并发编程的艺术-笔记

## 一 并发编程的挑战

### 上下文切换

- 上下文切换：CPU是通过给每个线程分配时间片来实现多线程机制。
- 多线程不一定快：当并发执行累加操作不超过百万次时，速度会比串行执行累加操作慢。
- 如何减少上下围切换：无锁并发编程、CAS算法、使用最少线程和使用协程。
  - 无锁并发编程：多线程竞争锁是，会引起上下文切换。可以使用一些方法来避免使用锁，如：将数据的ID按照Hash算法取模分段。
  - CAS算法：JAVA的Atomic包使用CAS算法来更新数据，而不需要加锁；
  - 使用最少线程：避免创建不需要的线程；
  - 协程：单线程中使用多任务调度，并维持多个任务间的切换。

### 死锁

由于两个或两个以上的线程竞争同一资源或者由于彼此通信而造成的一种阻塞现象。

![](https://raw.githubusercontent.com/wqh8522/my_note/pic/java/deadLocak.png)

避免死锁：

- 避免一个线程同时获取多个锁；
- 避免一个线程在锁内同时占用多个资源；
- 尝试使用定时锁，使用lock.tryLock（timeout）来替代内部锁机制；
- 对于数据库锁，加锁和解锁必须在一个数据库连接。

